<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apigee Enterprise API Reference</title>
    <meta content="authenticity_token" name="csrf-param" />
<meta content="Ypsjzh/R/ruUIGc02PgqRyk/31ZL6NZQx2LrszgQ5Bk=" name="csrf-token" />
    <link href="/assets/application-a2cf2fc60e7f628224d6179e9acb6bde.css" media="all" rel="stylesheet" type="text/css" />
    <script src="/assets/application-3d91ebb39ac1bf40fce53b1fddef09ec.js" type="text/javascript"></script>
	
    <link rel="shortcut icon" href="images/favicon.ico">
    <link href="/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />
    <link href="images/apple-touch-icon.png" rel="apple-touch-icon">
    <link href="images/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72">
    <link href="images/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114">

  </head>


  <body>

 <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
		<a class="brand" href="#">Apigee Enterprise API</a>

        <div class="container">
            <ul class="nav">
	          <li><a href="/quick_starts">Quick Starts</a></li>
              <li><a href="/api_resources">API Resources</a></li>
              <li><a href="/api_methods">API Methods</a></li>
              <li><a href="/parameters">Parameters</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div> 

    <div class="container">
      <div class="content">
        <div class="row">
           <div class="span12">
			<div>
</div>
            <a class="btn" data-toggle="modal" href="#myModal" >Quick Start Overview</a>

<div class="modal hide fade" id="myModal">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">Ã—</button>
    <h3>Overview</h3>
  </div>
  <div class="modal-body">



This doc provides a set of cURL commands that you can use to get up and running with Apigee Enterprise.

You require an account in a organization enabled on Apigee Enterprise. 
If you need an organization, contact info@apigee.com

You can obtain cURL from http://curl.haxx.se

This Quick Start uses a subset of the Apigee Public API to walk you through the basic flow of creating, uploading, deploying, invoking, and debugging an API.

In this tutorial we will manage the the Yahoo Weather API with Apigee Enterprise

It is recommend that you first run Search and Replace of the following values:

* Find  myname and replace with the username for you Apigee Enterprise organization
  FOR SECURITY YOU SHOULD MANUALLY SUBSTITUTE YOUR PASSWORD FOR MYPASS WITH EACH REQUEST
* Find {myorg} and replace with the name of your organization

If you correctly replace these values, then you can copy and paste each curl command to your terminal command line, replace mypass with your password, and execute the command successfully.

NOTE THAT SPECIFIC VALUES WITHIN RESPONSES MAY DIFFER, GIVEN DIFFERENCE IN USERNAME, TIME VALUES, ETC.

See the end of this document for troubleshooting tips.


  </div>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">Close</a>
  </div>
</div>

<div class="tabbable">
<ul class="nav nav-tabs" id="qsHead">
  <li class="active"><a href="#provision" data-toggle="tab">Provision an API</a></li>
  <li><a href="#debug" data-toggle="tab">Trace API Calls</a></li>
  <li><a href="#policy" data-toggle="tab">Attach a Policy to an API</a></li>
  <li><a href="#apps" data-toggle="tab">Provision Developers and Apps</a></li>
  <li><a href="#analytics" data-toggle="tab">API Analytics</a></li>
  <li><a href="#deploy" data-toggle="tab">Develop APIs Locally</a></li>
</ul>

<div class="tab-content">
<div class="tab-pane active fade in" id="provision">

	<!-- Begin Quick Start -->
	<h4>Overview</h4>
<p>The Quick Start shows you how to use the Apigee API to construct an API facade. This is always the first step that you take when using Apigee to manage an API, and you can create a API using the Apigee UI or the API.</p>

<p>When you create an API in Apigee, the system creates a bundle of configuration and code called an 'API Proxy'.</p> 

<p>In a sense you create two entities, an API facade, which is the 'API interface' that you expose to developers, and the second is the concrete implementation of the API intermediary, which performs policy-based processing and analysis on behalf of your managed API.</p> 

<p>In this example we will create a managed Weather API.</p> 

<p>Since you may not have an API of your own, we'll start by managing the Yahoo Weather API. We could have chosen any publicly available Web API. You should feel free to use your own, or, if you don't yet have an API, select from the vast universe of public APIs to complete this exercise.</p>

<p>We begin by submitting a request to the weather API, simply to make sure our HTTP client (in this case, cURL) and the API (in the case, the Yahoo Weather API) are both running as expected.  </p>
	
	<h4>Submit Request to Weather API</h4>

	<div class="well">
		$ curl http://weather.yahooapis.com/forecastrss?w=12797282&</pre>
		</div>
Sample Response
			<div class="well">
			<script src="http://gist.github.com/3f5e1b7f1fa52c633e77.js"></script>
			</div>

<p>Ideally, you see something like the sample response above. If you get any errors it's a good time to debug curl, your network connection, or Yahoo.
</p>
<p>Now we move on to Apigee. In this first step, we'll keep it simple, and just invoke the API to verify our Organization. 
</p>
<p>	
You Organization is an important component of the API. You will submit your Organization with every request to Apigee. Think of it as your Apigee account. </p>
<p>You need to know your Apigee Organization in advance, so if you do not know it, contact your administrator, or request an Apigee trial account.
</p>
<p>Note in this request that you provide a username and password for Basic Authentication against the API. This username:password combination is valid for your user account within your Organization. (In some cases, you might belong to multiple Organizations, so if you have auth failures, start by checking the Organization in your request.) 
</p>
<h4>Check your Apigee Organization</h4>
	
<div class="well">$ curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{myorg}</div>

Sample Response

<div id="well"><pre>{
  "createdAt" : 1336659666648,
  "createdBy" : "admin",
  "displayName" : "My Organization",
  "environments" : [ "test", "prod" ],
  "lastModifiedAt" : 1336659666648,
  "lastModifiedBy" : "admin",
  "name" : "myorg",
  "properties" : {
    "property" : [ ]
  },
  "type" : "trial",
  "users" : {
    "role" : [ ]
  }
</pre></div>

<p>This request returns a set of metadata about your Organization--when it was created and by whom, its display name, and so on. You can typically work with Apigee blissfully unaware of these settings. But, if you ever run into authentication problems, it's always good to go back and check your Organization. 
</p>
<p>TIP: If you run this command and nothing returns, add the flag '-v' to he end. You can do this with any curl command in this Quick Start. It lets you see what HTTP error may have been thrown. Usually, it's a 401 (bad username/password) or a 404 (not found).
</p>
<h4>List APIs in your Organization</h4>

APIs are collected under Organizations. An Organization, in other words, is an 'API Provider'. So, let's see what APIs exist in our 'org'. If this is your first time using Apigee, it is likely that your list will be empty. However, if you are following in a colleague's footsteps, you may find an API or two already defined in your Organization.
	
<div id="well"><pre>$ curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{myorg}/apis</pre></div>

Sample Responses:
<div id="well"><pre>[ "api1", "api2", "api3" ]</pre></div>

	<h4>Create an API</h4>
Now we will create an API on the Apigee platform. This API will provide a 'front-end' to the API we will manage. A new URL will be generated, as will a processing pipeline (a set of flows) to manage requests submitted to the new URL.

<div id="well"><pre>$ curl https://api.enterprise.apigee.com/v1/o/{myorg}/apis -u myname:mypass -H 'Content-type:application/json' -X POST  -d'{"name" : "weatherAPI"}'</pre></div>

Sample Response	
<div class="well"><pre>{
	"configurationVersion": {
		        "majorVersion": 4, 
		        "minorVersion": 0
		    }, 
		    "contextInfo": "Revision 1 of application weatherTest, in organization {myorg}", 
		    "createdAt": 1343182801400, 
		    "createdBy": "andrew@apigee.com", 
		    "lastModifiedAt": 1343182801400, 
		    "lastModifiedBy": "andrew@apigee.com", 
		    "name": "weatherAPI", 
		    "policies": [], 
		    "proxyEndpoints": [], 
		    "resources": [], 
		    "revision": "1", 
		    "targetEndpoints": [], 
		    "targetServers": [], 
		    "type": "Application"}</pre></div>
	
In the response, you can begin to see the anatomy of the API Proxy that Apigee generates. Some key elements are:
<ul><li>A name: This is the name that will display in the Apigee UI. (Call it whatever you want.)</li>
<li>One or more (but usually just one) Proxy Endpoints: This is the definition of the 'receiver' or the front-end API and defines how messages are submitted to your proxied API.</li>
<li>One or more (but usually just one) Target Endpoints: This is the definition of the 'sender' to the 'backend service' -end API and defines how messages are forwarded from your proxied API over the Internet to the remote API--in this case, the Yahoo Weather API.</li>
<li>One or more Policies: Policies are the heart of an API Proxy. They change the behavior of your API and provide services such as rate-limiting, security, transformations, and so on. We'll look at Policies in the next Quick Start.</li></ul>

<h4>List APIs</h4>

<p>Now let's list APIs in our org again and see our new API listed.</p>

<div id="well"><pre>$ curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{myorg}/apis</pre>
</div>

Sample Response
<div id="well"><pre>[ "weatherAPI" ]</pre></div>	

<h4>Get an API</h4>

<p>Now let's do a GET on our new API and see what details are returned.</p>
	
<div id="well"><pre>$ curl -u myname:mypass -H "Accept: application/json" https://api.enterprise.apigee.com/v1/o/{myorg}/apis/weatherAPI</pre></div>
	
Sample Response
<div id="well"><pre>{
  "name" : "weatherAPI",
  "revision" : [ "1" ]
}</pre></div>
	
<h4>List API Revisions</h4>

<p>We mentioned that an API is embodied in an API Proxy, which is a bundle of code and configuration. Each API Proxy in Apigee has a sequentially numbered set of packages, which the system tracks for you. Every time you modify an API Proxy (for example, by attaching a polict to it), the system generates a new revision of the API Proxy. This provides a rudimentary form of revision control, which you should feel free to augment by using your own source-code management system. (In other words, store your latest working revision of an API proxy in your SCM!)</p>

<div id="well"><pre>$ curl -u myname:mypass "Accept: application/json" https://api.enterprise.apigee.com/v1/o/{myorg}/apis/weatherAPI</pre></div>

Sample Response

<div id="well"><pre>{
  "name" : "weatherAPI",
  "revision" : [ "1" ]
}</pre></div>

 
<h4>Get API Revision</h4>

Note that we only have one revision of the Weather API. That's because we just created it. We do a GET on this revision to get a detailed view.

<div id="well"><pre>$ curl -u myname:mypass -H "Accept:application/json" https://api.enterprise.apigee.com/v1/o/{myorg}/apis/weatherAPI/revisions/1</pre></div>
Sample Response
<div id="well"><pre>{
  "configurationVersion" : {
    "majorVersion" : 4,
    "minorVersion" : 0
  },
  "contextInfo" : "Revision 1 of application weatherAPI, in organization {myorg}",
  "createdAt" : 1343178905169,
  "createdBy" : "andrew@apigee.com",
  "lastModifiedAt" : 1343178905169,
  "lastModifiedBy" : "andrew@apigee.com",
  "name" : "weatherAPI",
  "policies" : [ ],
  "proxyEndpoints" : [ ],
  "resources" : [ ],
  "revision" : "1",
  "targetEndpoints" : [ ],
  "targetServers" : [ ],
  "type" : "Application"
}</pre></div>

<h4>Add a Proxy Endpoint to the API</h4>

<p>The key piece of configuration that we add in this step is the basepath for our API.
</p>
<p>The basepath determines how requests are routed to this specific API proxy. Remember, you could have 10 or hundreds of APIs proxied on Apigee. HOw does Apigee know to route requests to this specific API?</p>
It does this using basepaths. A basepath is used for URL pattern matching on incoming request messages. 
Remember, the virtual host detrmines the envirnment that a message is routed to. The base path determines the API Proxy in that environment that the request is routed to.
<p>Thus, if we set the basepath to '/weather', and we deploy to the 'test' environment, our API proxy will service requests sent to http://{myorg}-test.apigee.net.</p>
<p>(Note that you can also set the base path when you deploy. Any basepath that you set when you deploy will be appended to the basepath set in the proxy endpoint in this step.)</p>

<div id="well"><pre>curl -u myname:mypass -H "Content-Type: application/json" -X POST -d'{ "connection" : { "basePath" : "/weather", "virtualHost" : [ "default" ] }, "description" : "Default Proxy to create flows on an API", "faultRuleNames" : [ ], "faultRules" : [ ], "flowNames" : [ "PreFlow", "PostFlow" ], "flows" : [ ], "name" : "default", "preFlow" : { "name" : "PreFlow", "request" : { "steps" : [ ] }, "response" : { "steps" : [ ] } }, "routeRule" : [ { "name" : "default", "targetEndpoint" : "default" } ], "routeRuleNames" : [ "default" ], "type" : "Proxy" } https://api.enterprise.apigee.com/v1/o/{myorg}/apis/weatherAPI/revisions/1/proxies</pre></div>

Sample Response

<div id="well"><pre>{
  "connection" : {
    "basePath" : "/weather",
    "virtualHost" : [ "default" ]
  },
  "description" : "Default Proxy to create flows on an API",
  "faultRuleNames" : [ ],
  "faultRules" : [ ],
  "flowNames" : [ "PreFlow", "PostFlow" ],
  "flows" : [ ],
  "name" : "default",
  "preFlow" : {
    "name" : "PreFlow",
    "request" : {
      "steps" : [ ]
    },
    "response" : {
      "steps" : [ ]
    }
  },
  "routeRule" : [ {
    "name" : "default",
    "targetEndpoint" : "default"
  } ],
  "routeRuleNames" : [ "default" ],
  "type" : "Proxy"
}</pre>
</div>
<h4>Add a Target Endpoint to the API</h4>
<div id="well"><pre>curl -u myname:mypass -H "Content-Type: application/json" -X POST -d'{ "connection" : { "uRL" : "http://weather.yahooapis.com/forecastrss?w=12797282&" }, "description" : "Connection to Weather API", "faultRuleNames" : [ ], "faultRules" : [ ], "flowNames" : [ "PreFlow", "PostFlow" ], "flows" : [ ], "name" : "default", "preFlow" : { "name" : "PreFlow", "request" : { "steps" : [ ] }, "response" : {"steps" : [ ]}}, "type" : "Target"}' https://api.enterprise.apigee.com/v1/o/{myorg}/apis/weatherAPI/revisions/1/targets</pre></div>

Sample Response

<div id="well"><pre>{
  "connection" : {
    "uRL" : "http://weather.yahooapis.com/forecastrss?w=12797282&"
  },
  "description" : "Connection to Weather API",
  "faultRuleNames" : [ ],
  "faultRules" : [ ],
  "flowNames" : [ "PreFlow", "PostFlow" ],
  "flows" : [ ],
  "name" : "default",
  "preFlow" : {
    "name" : "PreFlow",
    "request" : {
      "steps" : [ ]
    },
    "response" : {
      "steps" : [ ]
    }
  },
  "type" : "Target"
}</pre></div>

<h4>How to List Environments</h4>
<div id="well"><pre>$ curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{myorg}/environments</pre></div>
Sample Response

<div id="well"><pre>[ "test", "prod" ]</pre></div>

<h4>Deploy your API to the Test Environment</h4>


<div id="well"><pre>$ curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{myorg}/apis/weatherAPI/revisions/1/deployments?action=deploy&env=test&basepath=%2fweather</pre></div>

Sample Response

<div id="well"><pre>{
  "aPIProxy" : "weatherAPI",
  "environment" : [ ],
  "name" : "1",
  "organization" : "{myorg}"
}</pre></div>

<h4>How to Submit Requests to your API at Runtime</h4>

<p>The proxied URL that Apigee generates for you depends on the environment where you deploy your API Proxy.</p>
The proxied URL is a concatenation of:

<ul><li>Your organization name</li>
<li>The environment name</li>
<li>The Apigee Root URL (apigee.net, NOT api.enterprise.apigee.com) </li>
<li>The basepath you configure for the API (in our example, /weather)</li></ul>


<h4>How to Get the Virtual Host for an Environment</h4>

<div id="well"><pre>curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{myorg}/environments/test/virtualhosts</pre></div>
Sample Response
<div id="well"><pre>[ "default" ]</pre></div>

<h4>How to Get the Virtual Host Address for an Environment</h4>

<div id="well"><pre>curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{myorg}/environments/test/virtualhosts/default</pre></div>
Sample Response
<div id="well"><pre>{
  "hostAliases" : [ "{myorg}-test.apigee.net" ],
  "interfaces" : [ ],
  "name" : "default",
  "port" : "80"
}</pre></div>

Thus to invoke our API we submit requests to:
<div id="well"><pre>http://myorg-test.apigee.net/weather</pre></div>

<h4>Submit Request via Apigee API</h4>

<div id="well"><pre>$ curl 'http://myorg-test.apigee.net/weather/forecastrss?w=12797282&'</pre></div>

<p>Now let's submit a request that invokes the Yahoo Weather API by calling the Apigee API proxy, rather than directly calling Yahoo. </p>
Sample Response

<div id="well"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot; ?&gt;
		&lt;rss version=&quot;2.0&quot; xmlns:yweather=&quot;http://xml.weather.yahoo.com/ns/rss/1.0&quot; xmlns:geo=&quot;http://www.w3.org/2003/01/geo/wgs84_pos#&quot;&gt;
			&lt;channel&gt;		
&lt;title&gt;Yahoo! Weather - Palo Alto, CA&lt;/title&gt;
&lt;link&gt;http://us.rd.yahoo.com/dailynews/rss/weather/Palo_Alto__CA/*http://weather.yahoo.com/forecast/USCA1093_f.html&lt;/link&gt;
&lt;description&gt;Yahoo! Weather for Palo Alto, CA&lt;/description&gt;
. . . 
&lt;/rss&gt;

&lt;!-- api17.weather.ac4.yahoo.com uncompressed/chunked Fri Jun  8 11:33:23 PDT 2012 --&gt;</pre></div>
	<!-- End of Quick Start -->

</div>

<div class="tab-pane fade in" id="debug">
	<!-- Begin Quick Start -->
	<p>Once you've set up an API in Apigee, you need to be able to debug the traffic flowing through it. You do this in Apigee by tracing API calls.</p>

<h4>Create Debug Session and Specify Message Filter</h4>

<p>Apigee contains a set of instrumentation that can be turned on by creating a debug session. </p>

<div id="well"><pre>$ curl -u myname:mypass -H "Content-type:application/json"  -X POST -d'{"flowdebugsession":{"name":"check","matchingheaders":{"entry":{"key":"trapme","value":"true"}},"matchingqparams":{}}}' 'https://api.enterprise.apigee.com/v1/organizations/apigee-cs/environments/test/apis/weatherAPI/revisions/1/debugsessions?session=MySession&header_trapme=true'</pre></div>

Sample Response

<div id="well"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;FlowDebugSession name=&quot;MySession&quot;&gt;
    &lt;matchingHeaders&gt;
        &lt;entry&gt;
            &lt;key&gt;trapme&lt;/key&gt;
            &lt;value&gt;true&lt;/value&gt;
        &lt;/entry&gt;
    &lt;/matchingHeaders&gt;
    &lt;matchingQParams/&gt;
&lt;/FlowDebugSession&gt;</pre></div>

<h4>Submit Request(s) via Apigee API (with header specified in Debug Session)</h4>

<p>Once the debug session has been initialized, you can run traffic through the API. Until messages trip the filter, oyu won;t have any results on the debug output.</p>

<div id="well"><pre>$ curl -H "trapme:true" 'http://apigee-cs-test.apigee.net/WeatherAPI/forecastrss?w=12797282&'</pre></div>

Sample Response

<div id="well"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot; ?&gt;
		&lt;rss version=&quot;2.0&quot; xmlns:yweather=&quot;http://xml.weather.yahoo.com/ns/rss/1.0&quot; xmlns:geo=&quot;http://www.w3.org/2003/01/geo/wgs84_pos#&quot;&gt;
			&lt;channel&gt;		
&lt;title&gt;Yahoo! Weather - Palo Alto, CA&lt;/title&gt;
&lt;link&gt;http://us.rd.yahoo.com/dailynews/rss/weather/Palo_Alto__CA/*http://weather.yahoo.com/forecast/USCA1093_f.html&lt;/link&gt;
&lt;description&gt;Yahoo! Weather for Palo Alto, CA&lt;/description&gt;
. . . 
&lt;/rss&gt;

&lt;!-- api17.weather.ac4.yahoo.com uncompressed/chunked Fri Jun  8 11:33:23 PDT 2012 --&gt;</pre></div>

<h4>Get Debug Session Identifier</h4>

<p>When you are ready to retrieve results, you first retrieve the ID for the debug session from Apigee.</p>
<div id="well"><pre>$ curl -u myname:mypass -H 1/organizations/apigee-cs/environments/test/apis/WeatherAPI/revisions/2/debugsessions/MySession/data'</pre></div>

Sample Response
<div id="well"><pre>{"List":{"Item":"7d6e2eb1-581a-4db0-8045-20d9c3306549__17142"}}</pre></div>

<h4>Get Debug Session by Identifier</h4>

<p>Once you have the session ID, you use it to request the debug output from Apigee.</p>

<div id="well"><pre>$ $ curl -u myname:mypass -H "Accept: application/json" 'https://api.enterprise.apigee.com/v1/organizations/apigee-cs/environments/test/apis/WeatherAPI/revisions/1/debugsessions/check/data/7d6e2eb1-581a-4db0-8045-20d9c3306549__17142'</pre></div>

Sample Response
[See Sample Debug JSON Output here: https://gist.github.com/da41c55a04b44f61bde7]

<div id="well">
		<script src="http://gist.github.com/da41c55a04b44f61bde7.js"></script>			
</div>

<h4>Send Debug JSON output to a local file</h4>

<div id="well"><pre>$ curl -u myname:mypass -H "Accept: application/json" 'https://api.enterprise.apigee.com/v1/organizations/apigee-cs/environments/test/apis/WeatherAPI/revisions/1/debugsessions/check/data/7d6e2eb1-581a-4db0-8045-20d9c3306549__17142' > MySession.json</pre></div>

	<!-- End of Quick Start -->
</div>	
	
<div class="tab-pane fade in" id="policy">
	<!-- Begin Quick Start -->
	<h4>Managing APIs with Policies</h4>
<p>Policies enable you to madify the behavior of your APIs without writing any code.
</p>
<p>Apigee provides a set of policies that cover many of the basic requirements of API Management.
</p>
<p>You can apply these policies to your APIs with very little effort, and then, as your requirements change over time, you can simply update policies without needing to rewrite code--unless you really want to. (Apigee also lets you write Java, Javascript, and Python to customize the behavior of your APIs.)</p>

Enabling a Policy is a three step process:
<ol><li>Create a policy and configure it with appropiate settings</li>
<li>Attach the policy to the API proxy so that it is enforced at the right point in the pipeline</li>
<li>Deploy the API to the approriate environment (test or prod, depending on your requirements)</li></ol>

	<p>In this quick start we will create a very common type of policy: a Rate Limiting Policy that enforces a quota on developers.
	</p>
	<p>The policy that we attach to our API will restrict developers from making more than 1 request to the API per minute.
	</p>
	<p>(This isn't very realistic of course--but it makes it easy to seethe effects of a policy in real time.)
	</p><h4>Create a Quota Policy</h4>
	<p>First create the Quota Policy</p>
	<p>There are a bunch of options in here, but we will focus on setting the key configuration settings for a Quota: the timeinterval value and the timeUnit value. </p>

<div id="well"><pre>$ curl -u myname:mypass  -H "Content-Type: application/json" -X POST -d'{"policyType" : "Quota","alert" : [ ],"allow" : {"count" : 1},"async" : false,"continueOnError" : false,"distributed" : false,"enabled" : true,"faultRules" : [ ],"interval" : {"ref" : "request.header.quota_count","value" : "1"},"name" : "WeatherQuota","synchronous" : false,"timeUnit" : {"ref" : "request.header.quota_timeout","value" : "minute"}}' https://api.enterprise.apigee.com/v1/o/{myorg}/apis/weatherAPI/revisions/1/policies
</pre></div>

Sample Response

<div id="well"><pre>{
    &quot;alert&quot;: [], 
    &quot;allow&quot;: {
        &quot;count&quot;: 1
    }, 
    &quot;async&quot;: false, 
    &quot;continueOnError&quot;: false, 
    &quot;distributed&quot;: false, 
    &quot;enabled&quot;: true, 
    &quot;faultRules&quot;: [], 
    &quot;interval&quot;: {
        &quot;ref&quot;: &quot;request.header.quota_count&quot;, 
        &quot;value&quot;: &quot;1&quot;
    }, 
    &quot;name&quot;: &quot;WeatherQuota&quot;, 
    &quot;policyType&quot;: &quot;Quota&quot;, 
    &quot;synchronous&quot;: false, 
    &quot;timeUnit&quot;: {
        &quot;ref&quot;: &quot;request.header.quota_timeout&quot;, 
        &quot;value&quot;: &quot;minute&quot;
    }
}</pre></div>

<h4>Attach a Quota Policy to the APIs Request PreFlow</h4>
Now we configure the point in the pipeline where the policy is enforced.
In this example, we want to enforce the Quota on incoming requests before we do any other processing. 
We specify this by attaching the policy to the Request Preflow.

<div id="well"><pre>$ curl -u myname:mypass -H "Content-type: application/octet-stream" -X POST 'https://api.enterprise.apigee.com/v1/o/{myorg}/apis/weatherAPI/revisions/1/proxies/default/flows/PreFlow/steps?name=WeatherQuota&enforcement=request'</pre></div>
Sample Response
<div id="well"><pre>{
    "faultRules": [], 
    "name": "WeatherQuota"
}</pre></div>

<h4>Verify Policy Attachment</h4>

<div id="well"><pre>$ curl -H "Accept: application/json" -u myname:mypass 'https://api.enterprise.apigee.com/v1/o/{myorg}/apis/weatherAPI/revisions/1/proxies/default/flows/PreFlow'</pre></div>
	
Sample Response
<div id="well"><pre>{
  &quot;name&quot; : &quot;PreFlow&quot;,
  &quot;request&quot; : {
    &quot;steps&quot; : [ {
      &quot;Step&quot; : {
        &quot;faultRules&quot; : [ ],
        &quot;name&quot; : &quot;WeatherQuota&quot;
      }
    } ]
  },
  &quot;response&quot; : {
    &quot;steps&quot; : [ ]
  }
}</pre></div>

<h4>Deploy to Test Environment</h4>

<div id="well"><pre>$ curl -u myname:mypass -H "Accept:application/json" 'https://api.enterprise.apigee.com/v1/o/{myorg}/apis/weatherAPI/revisions/1/deployments?action=deploy&env=test&basepath=/weather'</pre></div>

Sample Response

<div id="well"><pre>{
  &quot;aPIProxy&quot; : &quot;weatherAPI&quot;,
  &quot;configuration&quot; : {
    &quot;basePath&quot; : &quot;/weather&quot;,
    &quot;steps&quot; : [ ]
  },
  &quot;environment&quot; : &quot;test&quot;,
  &quot;name&quot; : &quot;1&quot;,
  &quot;organization&quot; : &quot;myorgs&quot;,
  &quot;revision&quot; : &quot;1&quot;,
  &quot;server&quot; : [ {
    &quot;status&quot; : &quot;deployed&quot;,
    &quot;type&quot; : [ &quot;message-processor&quot; ],
    &quot;uUID&quot; : &quot;90096dd1-1019-406b-9f42-fbb80cd01200&quot;
  }, {
    &quot;status&quot; : &quot;deployed&quot;,
    &quot;type&quot; : [ &quot;message-processor&quot; ],
    &quot;uUID&quot; : &quot;7d6e2eb1-581a-4db0-8045-20d9c3306549&quot;
  }, {
    &quot;status&quot; : &quot;deployed&quot;,
    &quot;type&quot; : [ &quot;router&quot; ],
    &quot;uUID&quot; : &quot;1619e2d7-c822-45e0-9f97-63882fb6a805&quot;
  }, {
    &quot;status&quot; : &quot;deployed&quot;,
    &quot;type&quot; : [ &quot;router&quot; ],
    &quot;uUID&quot; : &quot;8a5f3d5f-46f8-4e99-b4cc-955875c8a8c8&quot;
  } ],
  &quot;state&quot; : &quot;deployed&quot;
}</pre></div>

<h4>Verify Policy Enforcement</h4>

<p>Send at least two requests in under a minute.
</p>
<div id="well"><pre>curl http://{myorg}-test.apigee.net</pre></div>


Sample Response
<div id="well">&lt;pre&gt;&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;UTF-8&#x27;?&gt;&lt;fault&gt;&lt;faultstring&gt;policies.ratelimit.QuotaViolation&lt;/faultstring&gt;&lt;detail&gt;&lt;errorcode&gt;policies.ratelimit.QuotaViolation&lt;/errorcode&gt;&lt;/detail&gt;&lt;/fault&gt;</pre></div>


<h4>Deploy to Production</h4>

<div id="well"><pre>$ curl -u myname:mypass -X POST 'https://api.enterprise.apigee.com/v1/o/{myorg}/apis/weatherAPI/revisions/1/deployments?action=deploy&env=prod&basepath=/weather'</pre></div>
Sample Response
<div id="well"><pre>{
  &quot;aPIProxy&quot; : &quot;weatherAPI&quot;,
  &quot;configuration&quot; : {
    &quot;basePath&quot; : &quot;/weather&quot;,
    &quot;steps&quot; : [ ]
  },
  &quot;environment&quot; : &quot;prod&quot;,
  &quot;name&quot; : &quot;1&quot;,
  &quot;organization&quot; : &quot;apigee-cs&quot;,
  &quot;revision&quot; : &quot;1&quot;,
  &quot;server&quot; : [ {
    &quot;status&quot; : &quot;deployed&quot;,
    &quot;type&quot; : [ &quot;message-processor&quot; ],
    &quot;uUID&quot; : &quot;90096dd1-1019-406b-9f42-fbb80cd01200&quot;
  }, {
    &quot;status&quot; : &quot;deployed&quot;,
    &quot;type&quot; : [ &quot;message-processor&quot; ],
    &quot;uUID&quot; : &quot;7d6e2eb1-581a-4db0-8045-20d9c3306549&quot;
  }, {
    &quot;status&quot; : &quot;deployed&quot;,
    &quot;type&quot; : [ &quot;router&quot; ],
    &quot;uUID&quot; : &quot;1619e2d7-c822-45e0-9f97-63882fb6a805&quot;
  }, {
    &quot;status&quot; : &quot;deployed&quot;,
    &quot;type&quot; : [ &quot;router&quot; ],
    &quot;uUID&quot; : &quot;8a5f3d5f-46f8-4e99-b4cc-955875c8a8c8&quot;
  } ],
  &quot;state&quot; : &quot;deployed&quot;
}</pre></div>

<h4>Submit Request to Production API</h4>

<div id="well"><pre>$ curl 'http://{myorg}-prod.apigee.net/weather'</pre></div>

Sample Response

<div id="well"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot; ?&gt;
		&lt;rss version=&quot;2.0&quot; xmlns:yweather=&quot;http://xml.weather.yahoo.com/ns/rss/1.0&quot; xmlns:geo=&quot;http://www.w3.org/2003/01/geo/wgs84_pos#&quot;&gt;
			&lt;channel&gt;		
&lt;title&gt;Yahoo! Weather - Palo Alto, CA&lt;/title&gt;
&lt;link&gt;http://us.rd.yahoo.com/dailynews/rss/weather/Palo_Alto__CA/*http://weather.yahoo.com/forecast/USCA1093_f.html&lt;/link&gt;
&lt;description&gt;Yahoo! Weather for Palo Alto, CA&lt;/description&gt;
. . . 
&lt;/rss&gt;

&lt;!-- api17.weather.ac4.yahoo.com uncompressed/chunked Fri Jun  8 11:33:23 PDT 2012 --&gt;</pre></div>


<h4>Undeploy the API Proxy from Test Environment</h4>

<div id="well"><pre>$ curl -u myname:mypass -H "Accept: application/json" -X POST https://api.enterprise.apigee.com/v1/o/{myorg}/apis/weatherAPI/revisions/1/deployments?action=undeploy&env=test</pre></div>
Sample Response

<div id="well"><pre>{
  &quot;aPIProxy&quot; : &quot;weatherAPI&quot;,
  &quot;configuration&quot; : {
    &quot;basePath&quot; : &quot;/&quot;,
    &quot;steps&quot; : [ ]
  },
  &quot;environment&quot; : &quot;test&quot;,
  &quot;name&quot; : &quot;1&quot;,
  &quot;organization&quot; : &quot;apigee-cs&quot;,
  &quot;revision&quot; : &quot;1&quot;,
  &quot;server&quot; : [ {
    &quot;status&quot; : &quot;undeployed&quot;,
    &quot;type&quot; : [ &quot;message-processor&quot; ],
    &quot;uUID&quot; : &quot;90096dd1-1019-406b-9f42-fbb80cd01200&quot;
  }, {
    &quot;status&quot; : &quot;undeployed&quot;,
    &quot;type&quot; : [ &quot;message-processor&quot; ],
    &quot;uUID&quot; : &quot;7d6e2eb1-581a-4db0-8045-20d9c3306549&quot;
  }, {
    &quot;status&quot; : &quot;undeployed&quot;,
    &quot;type&quot; : [ &quot;router&quot; ],
    &quot;uUID&quot; : &quot;1619e2d7-c822-45e0-9f97-63882fb6a805&quot;
  }, {
    &quot;status&quot; : &quot;undeployed&quot;,
    &quot;type&quot; : [ &quot;router&quot; ],
    &quot;uUID&quot; : &quot;8a5f3d5f-46f8-4e99-b4cc-955875c8a8c8&quot;
  } ],
  &quot;state&quot; : &quot;undeployed&quot;
}</pre></div>
    <!-- End of Quick Start -->
</div>
		
<div class="tab-pane fade in" id="apps">
	<!-- Begin Quick Start -->
	In this Quick Start, we go through the steps it takes to enable developers to create apps that consume your APIs.

<h4>Create an API Product</h4>

<p>The first step is to create an API Product. API Products form the basis of access control in Apigee. To use an API managed by Apigee a developer needs to acquire a consumer key that is approved to use an API Product. An API Product is really a bundle of your API resources (that is, URIs) combined with a 'service plan', or settings for a Quota Policy. Thus, an API Product is really just a definition of which URIs can be accessed, and how often.</p>

<div id="well">	<pre>$ curl -u myname:mypass -H "Content-Type:application/json" -X POST -d' {"approvalType" : "auto", "attributes" : [ { "name" : "RateLimit", "value" : "100"}, { "name" : "Threshold", "value" : "50" } ], "displayName" : "Free Weather API", "name" : "sandbox", "apiResources" : [ "/v2/**", "/v1/weather", "/v1/*/forecasts" ] }' https://api.enterprise.apigee.com/v1/o/{myorg}/apiproducts</pre></div>
	
Sample Response
<div id="well"><pre>{
	  "apiResources" : [ "/v2/**", "/v1/weather", "/v1/*/forecasts" ],
	  "approvalType" : "auto",
	  "attributes" : [ {
	    "name" : "RateLimit",
	    "value" : "100"
	  }, {
	    "name" : "Threshold",
	    "value" : "50"
	  } ],
	  "createdAt" : 1343190369768,
	  "createdBy" : "andrew@apigee.com",
	  "displayName" : "Free Weather API",
	  "lastModifiedAt" : 1343190369768,
	  "lastModifiedBy" : "andrew@apigee.com",
	  "name" : "sandbox"
	}</pre>
</div>

<h4>Create a Developer</h4>

<p>Now we register a developer in our Organization. </p>

<div id="well"><pre>$ curl -u myname:mypass -H "Content-type:application/json" -X POST -d'{"email" : "developer@apigee.com", "firstName" : "Nikola", "lastName" : "Tesla", "userName" : "theramin", "attributes" : [ { "name" : "region", "value" : "north"} ]
}' https://api.enterprise.apigee.com/v1/o/{myorg}/developers</pre></div>

Sample Response

<div id="well">
	<pre>{
	  "email" : "developer@apigee.com",
	  "firstName" : "Nikola",
	  "lastName" : "Tesla",
	  "userName" : "theramin",
	  "organizationName" : "{myorg}",
	  "status" : "active",
	  "attributes" : [ {
	    "name" : "region",
	    "value" : "north"
	  } ],
	  "createdAt" : 1343189787717,
	  "createdBy" : "andrew@apigee.com",
	  "lastModifiedAt" : 1343189787717,
	  "lastModifiedBy" : "andrew@apigee.com"
	}</pre></div>


<h4>Create an App for this Developer that consumes the Weather API Product</h4>

<p>Now register an app on behalf of the developer.</p>

<div id="well"><pre>$ curl -u myname:mypass -H "Content-type:application/json" -X POST -d'{"accessType" : "read", "attributes" : [ { "name" : "Language", "value" : "java"} ],"apiProducts": [ "sandbox"],"callbackUrl" : "www.apigee.com", "name" : "weatherApp"
}' https://api.enterprise.apigee.com/v1/o/{myorg}/developers/developer%40apigee%2Ecom/apps</pre></div>

Sample Response

<div id="well"><pre>{
  "accessType" : "read",
  "attributes" : [ {
    "name" : "Language",
    "value" : "java"
  } ],
  "callbackUrl" : "www.apigee.com",
  "createdAt" : 1343190620890,
  "createdBy" : "andrew@apigee.com",
  "credentials" : [ {
    "apiProducts" : [ {
      "apiproduct" : "sandbox",
      "status" : "approved"
    } ],
    "attributes" : [ ],
    "consumerKey" : "HQg0nCZ54adKobpqEJaE8FefGkdKFc2J",
    "consumerSecret" : "1eluIIdWG3JGDjE0",
    "status" : "approved"
  } ],
  "lastModifiedAt" : 1343190620890,
  "lastModifiedBy" : "andrew@apigee.com",
  "name" : "weatherApp",
  "status" : "approved"
}</pre>
</div>

<h4>Get the Consumer Key (the API Key)</h4>
<div id="well"><pre>$ curl -u myname:mypass -H "Accept: application/json" https://api.enterprise.apigee.com/v1/o/{myorg}/developers/developer%40api%2Ecom/apps/weatherApp/keys/HQg0nCZ54adKobpqEJaE8FefGkdKFc2J</pre></div>

Sample Response
<div id="well"><pre>{
  "apiProducts" : [ {
    "apiproduct" : "sandbox",
    "status" : "approved"
  } ],
  "attributes" : [ ],
  "consumerKey" : "HQg0nCZ54adKobpqEJaE8FefGkdKFc2J",
  "consumerSecret" : "1eluIIdWG3JGDjE0",
  "status" : "approved"
}</pre></div>

<h4>Approve the Consumer Key</h4>

<div id="well"><pre>$ curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{myorg}/developers/developer%40api%2Ecom/apps/weatherapp/keys/HQg0nCZ54adKobpqEJaE8FefGkdKFc2J?action=approve</pre></div>

Sample Response
	<div id="well"><pre>{
	  "apiProducts" : [ {
	    "apiproduct" : "sandbox",
	    "status" : "approved"
	  } ],
	  "attributes" : [ ],
	  "consumerKey" : "HQg0nCZ54adKobpqEJaE8FefGkdKFc2J",
	  "consumerSecret" : "1eluIIdWG3JGDjE0",
	  "status" : "approved"
	}</pre>
	</div>

<h4>Approve API Product for the Consumer Key</h4>
<div id="well"><pre>$ curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{myorg}/developers/developer%40apigee%2Ecom/apps/weatherApp/keys/HQg0nCZ54adKobpqEJaE8FefGkdKFc2J/apiproducts/sandbox?action=approve</pre></div>
    <!-- End of Quick Start -->
</div>

<div class="tab-pane fade in" id="analytics">
	<!-- Begin Quick Start -->
	<h4>API Analytics</h4>

<p>Apigee's Analytics API enables you to retrieve metrics for APIs running on Apigee. 
</p>
<h4>Get Statistics for all APIs across all Environments</h4>

This is a powerful API call, since it returns statistics for all of your APIs across all environments. 

One variation is to request message counts (i.e. total throughput) for all APIs for a day:

<div id="well"><pre>curl -u myname:mypass  'https://api.enterprise.apigee.com/v1/o/{myorg}/environments/test/stats/apis?select=message_count&timeRange=7/23/2012%2000:00~7/24/2012%2000:00&timeUnit=day&sortby=message_count&sort=DESC'</pre></div>

to add top 5 add topk

<div id="well"><pre>{
  "environments" : [ {
    "dimensions" : [ {
      "metrics" : [ {
        "name" : "message_count",
        "values" : [ {
          "timestamp" : 1343235600000,
          "value" : "2.0"
        }, {
          "timestamp" : 1343185200000,
          "value" : "0"
        }, {
          "timestamp" : 1343181600000,
          "value" : "0"
        }, {
          "timestamp" : 1343178000000,
          "value" : "0"
        }, {
          "timestamp" : 1343163600000,
          "value" : "0"
        } ]
      } ],
      "name" : "weatherAPI"
    }, {
      "metrics" : [ {
        "name" : "message_count",
        "values" : [ {
          "timestamp" : 1343235600000,
          "value" : "0"
        }, {
          "timestamp" : 1343185200000,
          "value" : "2.0"
        }, {
          "timestamp" : 1343181600000,
          "value" : "1.0"
        }, {
          "timestamp" : 1343178000000,
          "value" : "2.0"
        }, {
          "timestamp" : 1343163600000,
          "value" : "0"
        } ]
      } ],
      "name" : "harry1"
    }, {
      "metrics" : [ {
        "name" : "message_count",
        "values" : [ {
          "timestamp" : 1343235600000,
          "value" : "0"
        }, {
          "timestamp" : 1343185200000,
          "value" : "0"
        }, {
          "timestamp" : 1343181600000,
          "value" : "0"
        }, {
          "timestamp" : 1343178000000,
          "value" : "0"
        }, {
          "timestamp" : 1343163600000,
          "value" : "5.0"
        } ]
      } ],
      "name" : "proxy-test2"
    } ],
    "name" : "test"
  } ],
  "metaData" : {
  }
}</pre></div>

<div id="well"><pre>curl -u myname:mypass https://api.enterprise.apigee.com/v1/o/{myorg}/environments/test/stats/apis?select=sum(message_count)&timeRange=7/24/2012%2000:00~8/25/2012%2000:00&timeUnit=day</pre></div>

Sample Response
<div id="well"><pre>{
  "environments" : [ {
    "dimensions" : [ {
      "metrics" : [ {
        "name" : "sum(message_count)",
        "values" : [ {
          "timestamp" : 1343088000000,
          "value" : "5.0"
        }, {
          "timestamp" : 1343174400000,
          "value" : "0"
        } ]
      } ],
      "name" : "proxy-test2"
    }, {
      "metrics" : [ {
        "name" : "sum(message_count)",
        "values" : [ {
          "timestamp" : 1343088000000,
          "value" : "0"
        }, {
          "timestamp" : 1343174400000,
          "value" : "5.0"
        } ]
      } ],
      "name" : "harry1"
    }, {
      "metrics" : [ {
        "name" : "sum(message_count)",
        "values" : [ {
          "timestamp" : 1343088000000,
          "value" : "0"
        }, {
          "timestamp" : 1343174400000,
          "value" : "2.0"
        } ]
      } ],
      "name" : "weatherAPI"
    } ],
    "name" : "test"
  } ],
  "metaData" : {
    "samplingRate" : "100"
  }
}</pre></div>

Timestamp is a Unix Timestamp (seconds since January 1, 1970, Midnight GMT. 

<h4>Get Statistics for top APIs</h4>
view the first five top ranked APIs defined by highest throughput in the last 24 hours.

<div id="well"><pre>curl -u myname:mypass 'https://api.enterprise.apigee.com/v1/o/{myorg}/environments/test/stats/apis?select=message_count&timeRange=7/24/2012%2000:00~8/25/2012%2000:00&timeUnit=hour&sortby=message_count&sort=DESC&topk=5'</pre></div>

Sample Response

<div id="well"><pre>{
  "environments" : [ {
    "metrics" : [ ],
    "name" : "test"
  } ],
  "metaData" : {
    "samplingRate" : "100"
  }
}</pre></div>


<h4>Get Statistics for an Environment</h4>

<div id="well"><pre>curl -u myname:mypass 'https://api.enterprise.apigee.com/v1/o/{myorg}/environments/test/stats/?select=message_count&timeRange=7/24/2012%2000:00~8/25/2012%2000:00&timeUnit=hour'</pre></div>


<div id="well"><pre>{
  "environments" : [ {
    "metrics" : [ {
      "name" : "message_count",
      "values" : [ {
        "timestamp" : 1342285200000,
        "value" : "6.0"
      }, {
        "timestamp" : 1342400400000,
        "value" : "3.0"
      }, {
        "timestamp" : 1342411200000,
        "value" : "2.0"
      }, {
        "timestamp" : 1342447200000,
        "value" : "1.0"
      }, {
        "timestamp" : 1342458000000,
        "value" : "1.0"
      }, {
        "timestamp" : 1342526400000,
        "value" : "12.0"
      }, {
        "timestamp" : 1342530000000,
        "value" : "8.0"
      }, {
        "timestamp" : 1342533600000,
        "value" : "15.0"
      } ]
    } ],
    "name" : "test"
  } ],
  "metaData" : {
  }</pre></div>


<h4>Get Statistics on Custom Data</h4>

<h4>Upload Extract Variables Policy</h4>

<h4>Attach Policy to Target Post Flow</h4>

<h4>Upload Statistics Collector Policy</h4>

<h4>Attach Policy to Target Post Flow</h4>

<h4>Deploy Revision</h4>

<h4>Get Custom Report</h4>
    <!-- End of Quick Start -->
</div>

<div class="tab-pane fade in" id="deploy">
	<!-- Begin Quick Start -->
	<h4>API Development Models: Local and Cloud</h4>

<p>Sometimes you will find easiest to use a hybrid API development model, where you create API proxies via the Apigee UI, and then export the API proxy to your local machine for configuration and development.  </p>

<p>Apigee provides an open source tool written in Python that helps you simplify and manage the process of packaging and deploying APIs from your local machine to Apigee Enterprise Cloud.</p>

<h4>Getting Started</h4>
<ol>
<li>Download the Python Deploy script from Gihub.</li>
<li>Login to enterprise.apigee.com and Create an API. In this example, we create an API called SampleAPI, with a base path of /sample, and a server url of api.sample.com.</li>
<li>Navigate to 'APIs', select the API you created, and scroll down to Revisions</li>
<li>Right-click the Revision of your API and select "Download Revision". A ZIP file containing the API will download to your local machine.</li>
<li>Unzip the revision</li>
<li>Navigate to the location of the unzipped file on your local machine</li>
</ol>

<h4>API Proxy Revision Naming</h4>
Note the downloaded file name includes the API name, revision number, and download date.
<div id="well"><pre>sampleapi_rev1_2012_07_11.zip</pre></div>

<h4>API Proxy Basic File Structure</h4>
This is an API generated by Apigee Enterprise. It is an API proxy in its most basic form. 
<p>
This API defines an empty processing pipeline with two endpoints:
<ul>
<li>proxy, or inbound, endpoint configuration</li>
<li>target, or outbound, endpoint configuration</li>
</ul>

<div id="well"><pre>weatherAPI.xml
/proxies
-default.xml
/targets
-default.xml</pre></div>

<h4>API Proxy File Contents</h4>
weatherapi.xml
<div id="well"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;APIProxy revision=&quot;1&quot; name=&quot;weatherAPI&quot;&gt;
    &lt;ConfigurationVersion minorVersion=&quot;0&quot; majorVersion=&quot;4&quot;/&gt;
    &lt;CreatedAt&gt;1343186695608&lt;/CreatedAt&gt;
    &lt;CreatedBy&gt;andrew@apigee.com&lt;/CreatedBy&gt;
    &lt;LastModifiedAt&gt;1343186695608&lt;/LastModifiedAt&gt;
    &lt;LastModifiedBy&gt;andrew@apigee.com&lt;/LastModifiedBy&gt;
    &lt;Policies/&gt;
    &lt;ProxyEndpoints/&gt;
    &lt;Resources/&gt;
    &lt;TargetServers/&gt;
    &lt;TargetEndpoints/&gt;
&lt;/APIProxy&gt;</pre></div>

/proxies/default.xml

<div id="well"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;ProxyEndpoint name=&quot;default&quot;&gt;
    &lt;Description&gt;Default Proxy to create flows on an API&lt;/Description&gt;
    &lt;FaultRules/&gt;
    &lt;Flows/&gt;
    &lt;PostFlow name=&quot;PostFlow&quot;&gt;
        &lt;Request/&gt;
        &lt;Response/&gt;
    &lt;/PostFlow&gt;
    &lt;PreFlow name=&quot;PreFlow&quot;&gt;
        &lt;Request/&gt;
        &lt;Response/&gt;
    &lt;/PreFlow&gt;
    &lt;HTTPProxyConnection&gt;
        &lt;BasePath&gt;/weather&lt;/BasePath&gt;
        &lt;Properties/&gt;
        &lt;VirtualHost&gt;default&lt;/VirtualHost&gt;
    &lt;/HTTPProxyConnection&gt;
    &lt;RouteRule name=&quot;default&quot;&gt;
        &lt;TargetEndpoint&gt;default&lt;/TargetEndpoint&gt;
    &lt;/RouteRule&gt;
&lt;/ProxyEndpoint&gt;
</pre></div>

/targets/default.xml

<div id="well"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;TargetEndpoint name=&quot;default&quot;&gt;
    &lt;Description&gt;Connection to Weather API&lt;/Description&gt;
    &lt;FaultRules/&gt;
    &lt;Flows/&gt;
    &lt;PreFlow name=&quot;PreFlow&quot;&gt;
        &lt;Request/&gt;
        &lt;Response/&gt;
    &lt;/PreFlow&gt;
    &lt;HTTPTargetConnection&gt;
        &lt;Properties/&gt;
        &lt;URL&gt;http://weather.yahooapis.com/forecastrss?w=12797282&amp;amp;&lt;/URL&gt;
    &lt;/HTTPTargetConnection&gt;
&lt;/TargetEndpoint&gt;
</pre></div>

<h4>Setting up a Local Development Environment</h4>
It is usually helpful to import this file structure into your favorite editor to construct a project which will manage the files for you. You may also wish to store the files in a source code repository.

<h4>Using the Deploy Tool</h4>

<p>Now that you have your proxy files extracted to a directory called /apiproxy, you can use the Python tool that Apigee provides to Import (that os, upload) and deploy you API one fell swoop.</p>

<div id="well"><pre>$ python deploy.py -n sampleapi -u myname:mypass -h https://api.enterprise.apigee.com -o {myorg} -e test -p /sample -d ./apiproxy</pre></div>

<div id="well"><pre>-n The name of the API that will be created when this API Proxy is uploaded to Apigee Enterprise Cloud. The name will be the display name that you and other users of Apigee Enterprise Cloud will se in the API List. In our example above this is set to sampleapi.

-u Your username and password for your account in your Apigee Enterprise Cloud organization.

-h The base URL for your Apigee Enterprise Cloud organization.

-o The organization to which you belong. Contact your Apigee account administrator for this information.

-e The environment in your organization where you would like this API Proxy to be deployed. Note that this script will automatically import AND deploy the API Proxy so that it is immediately available for runtime access. Usually, you will set this to be the test environment. To get a list of available environments:

$ curl -u myname:mypass https://api.enterprisee.apigee.com/v1/o/{myorg}/environments/

-p The path used as a pattern match to route incoming message to this proxy. Prepend the virtual host for your environment to this path to submit message to the API Proxy your are importing with this script. In our example above this is /sample.

-d The path to the local directory where your API Proxy files reside. Note that your API Proxy files must be stored under a directory called /apiproxy. This script will ZIP your API Proxy into a bundle, and import the bundle to Apigee environment for your organization.</pre></div>


<h4>Import your API to Apigee</h4>

cd to your /apiproxy directory.

Run the deploy tool. For example

<div id="well"><pre>$ python deploy.py -n weatherAPI -u myname:mypass -h https://api.enterprise.apigee.com -o {myorg} -e test -p /weather -d ./apiproxy</pre></div>

<p>This single action will ZIP your files, push them to your Organization on Apigee, and deploy to the specified environment. </p>

<p>Once you have run the tool your API is ready to be invoked. (There is no secondary 'deploy' step.)</p>


<h4>How to Submit Requests to your API at Runtime</h4>
<p>The proxied URL for your API depends on the environment where you deploy your API Proxy.</p>
The proxied URL is a concatenation of:

<ul><li>Your organization name</li>
<li>The environment name</li>
<li>The Apigee Root URL (apigee.net, NOT api.enterprise.apigee.com) </li>
<li>The basepath you configure for the API (in our example, /weather)</li></ul>
Thus to invoke our API we submit requests to:
<div id="well"><pre>http://myorg-test.apigee.net/weather</pre></div>

<h4>Add Policies to your API</h4>

<p>Now that you have the basic structure of the API,  you can start to add some features. 
</p>
<p>Let's add a Rate Limiting Policy.</p>

<p>First, we need to create the Policies directory in our API proxy.</p>

<div id="well"><pre>$ cd apiproxy
$ ls
proxies		targets		weatherAPI.xml
$ mkdir policies
$ ls
policies	proxies		targets		weatherAPI.xml</pre></div>

<p>Here is a simple Quota Policy. This policy limits developers to 1 message per minute--not realistic, of course, but a simple way to see the effects of a Policy.</p>

<div id="well"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;Quota enabled=&quot;true&quot; continueOnError=&quot;false&quot; async=&quot;false&quot; name=&quot;QuotaPolicy&quot;&gt;
    &lt;FaultRules/&gt;
    &lt;Properties/&gt;
    &lt;Allow count=&quot;2&quot;/&gt;
    &lt;Interval&gt;1&lt;/Interval&gt;
    &lt;TimeUnit&gt;minute&lt;/TimeUnit&gt;
&lt;/Quota&gt;&lt;/pre></div>

<p>Create a file called <pre>QuotaPolicy.xml</pre> under <pre>/policies</pre>, and paste into it the policy body above.</p>

<h4>Attach a Policy to the Request PreFlow</h4>

<p>The Policy is now available to be executed in the processing pipeline of your API Proxy.</p>

<p>The next step is to decide where in the flow the policy should execute, and then attach it in the proper place.</p>

<p>Before any processing is done on a request, we want to make sure that the developer's quota has not been exceeded. 
</p>
<p>Thus we want the Quota Policy to execute first. To do so, we attach the Quota Policy to the "Request PreFlow" of the Proxy Endpoint.</p>

In the file <pre>/proxies/default.xml</pre>

<p>Paste this Policy step:</p>


   <div id="well"><pre>&lt;Step&gt;
       &lt;FaultRules/&gt;
       &lt;Name&gt;QuotaPolicy&lt;/Name&gt;
   &lt;/Step&gt;</pre></div>


Into the Proxy Endpoint's Request PreFlow
<div id="well"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;ProxyEndpoint name=&quot;default&quot;&gt;
    &lt;Description&gt;Default Proxy to create flows on an API&lt;/Description&gt;
    &lt;FaultRules/&gt;
    &lt;Flows/&gt;
    &lt;PostFlow name=&quot;PostFlow&quot;&gt;
        &lt;Request/&gt;
		    &lt;Step&gt;
               &lt;FaultRules/&gt;
               &lt;Name&gt;QuotaPolicy&lt;/Name&gt;
           &lt;/Step&gt;
        &lt;Response/&gt;
    &lt;/PostFlow&gt;
    &lt;PreFlow name=&quot;PreFlow&quot;&gt;
        &lt;Request/&gt;
        &lt;Response/&gt;
    &lt;/PreFlow&gt;
    &lt;HTTPProxyConnection&gt;
        &lt;BasePath&gt;/weather&lt;/BasePath&gt;
        &lt;Properties/&gt;
        &lt;VirtualHost&gt;default&lt;/VirtualHost&gt;
    &lt;/HTTPProxyConnection&gt;
    &lt;RouteRule name=&quot;default&quot;&gt;
        &lt;TargetEndpoint&gt;default&lt;/TargetEndpoint&gt;
    &lt;/RouteRule&gt;
&lt;/ProxyEndpoint&gt;</pre></div>

The Quota Policy will now execute when the Proxy receives a request from an app.

<h4>Which Flow Should I Use?</h4>

Every API Proxy pipeline provides at least 4 flows:
<ul><li>Request PreFlow</li>
<li>Request PostFlow</li>
<li>Response PreFlow</li>
<li>Response PostFlow</li></ul>

<h4>Import and Deploy Changes</h4>

cd to your apiproxy directory again.

<div id="well"><pre>$ python deploy.py -n weatherAPI -u myname:mypass -h https://api.enterprise.apigee.com -o {myorg} -e test -p /weather -d ./apiproxy</pre></div>

<h4>Verify that the Quota Policy is Functioning</h4>

<div id="well"><pre>http://myorg-test.apigee.net/weather</pre></div>

<div id="well"><pre>http://myorg-test.apigee.net/weather</pre></div>

<h4>Working with Variables</h4>

The Policy Body: Assign Message

In this policy we assign a response message based on a variable. 

In this case, the variable that we use is <pre>request.queryparam.input</pre>. This variable takes as input the value of the 'input' query parameter on the request.

Create the file: <pre>/apiproxy/policies/AssignResponse.xml</pre>

<div id="well"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;AssignMessage name=&quot;AssignResponse&quot;&gt;
	&lt;AssignTo type=&quot;response&quot; createNew=&quot;true&quot;&gt;&lt;/AssignTo&gt;
	&lt;IgnoreUnresolvedVariables&gt;false&lt;/IgnoreUnresolvedVariables&gt;
	&lt;Set&gt;
		&lt;Headers/&gt;
		&lt;QueryParams/&gt;
		&lt;FormParams/&gt;
		&lt;Payload contentType=&quot;text/plain&quot;&gt;Hello {request.queryparam.input}&lt;/Payload&gt;
	&lt;/Set&gt;
&lt;/AssignMessage&gt;</pre></div>

<p>Attach the Assign Response Policy to the Proxy Endpoint PreFlow</p>

<div id="well"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;ProxyEndpoint name=&quot;default&quot;&gt;
    &lt;Description&gt;Default Proxy to create flows on an API&lt;/Description&gt;
    &lt;FaultRules/&gt;
    &lt;Flows&gt;
		&lt;Flow&gt;
        &lt;Request/&gt;
        &lt;Response&gt;
            &lt;Step&gt;
                &lt;FaultRules/&gt;
                &lt;Name&gt;AssignResponse&lt;/Name&gt;
            &lt;/Step&gt;		
		&lt;/Response&gt;
		&lt;/Flow&gt;
	&lt;/Flows&gt;
    &lt;PostFlow name=&quot;PostFlow&quot;&gt;
        &lt;Request/&gt;
        &lt;Response/&gt;
    &lt;/PostFlow&gt;
    &lt;PreFlow name=&quot;PreFlow&quot;&gt;
        &lt;Request/&gt;
        &lt;Response/&gt;
    &lt;/PreFlow&gt;
    &lt;HTTPProxyConnection&gt;
        &lt;BasePath&gt;/weather&lt;/BasePath&gt;
        &lt;Properties/&gt;
        &lt;VirtualHost&gt;default&lt;/VirtualHost&gt;
    &lt;/HTTPProxyConnection&gt;
    &lt;RouteRule name=&quot;default&quot;&gt;
        &lt;TargetEndpoint&gt;default&lt;/TargetEndpoint&gt;
    &lt;/RouteRule&gt;
&lt;/ProxyEndpoint&gt;</pre></div>

<p>Now Import/Deploy your API:</p>

<div id="well"><pre>$ python deploy.py -n weatherAPI -u myname:mypass -h https://api.enterprise.apigee.com -o {myorg} -e test -p /weather -d ./apiproxy</pre></div>

Now invoke the API:

<pre>http://test-{myorg}.apigee.net/weather?input=World</pre>




Troubleshooting:

401: You do not have permission within your organization to import and deploy API Proxies. Contact your Apigee account administrator.
    <!-- End of Quick Start -->
</div>
	
<script>
  $(function () {
    $('#qsHead a:first').tab('show');
  })
</script>
		



<a href="/quick_starts/new" class="btn btn-primary"><span class="translation_missing" title="translation missing: en.helpers.links.new">New</span></a>

            </div>
        </div><!--/row-->
      </div><!--/content-->

       <footer>
        <p>&copy; Apigee, Inc. 2012</p>
      </footer> 

    </div> <!-- /container -->

    <!-- Placed at the end of the document so the pages load faster -->
     <script src="/assets/application-3d91ebb39ac1bf40fce53b1fddef09ec.js" type="text/javascript"></script> 

  </body>
</html>
